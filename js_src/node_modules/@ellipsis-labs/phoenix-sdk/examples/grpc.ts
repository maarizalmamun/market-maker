import base58 from "bs58";
import { getPhoenixEventsFromTransactionData } from "../src/index";
import { Client } from "rpc-websockets";

const url =
  "wss://stage.devnet.rpcpool.com/85e1e606-89fd-47a9-9a91-51ec4df1711a/whirligig";

const ws = new Client(url);

ws.on("open", async () => {
  const subscriptionId = await ws.call("transactionSubscribe", [
    {
      mentions: ["CS2H8nbAVVEUHWPF5extCSymqheQdkd4d7thik6eet9N"],
      failed: false,
      vote: false,
    },
    { commitment: "processed" },
  ]);
  console.log(subscriptionId);
  ws.on("transactionNotification", (data) => {
    const tx = data.result.value.transaction;
    for (const ix of tx.message.instructions) {
      if (!ix.accounts) {
        continue;
      }
      console.log(tx);
      const ix_accounts = ix.accounts.slice(1).map((a) => {
        return base58.encode(tx.message.accountKeys[a + 1]);
      });
      console.log(ix.accounts.slice(1));
      console.log(ix_accounts);
      console.log(ix.data);
    }
  });
});

console.log("done");
